FILE (GLOB cryptopp_SOURCES "${CMAKE_CURRENT_SOURCE_DIR}/*.cpp")
FILE (GLOB cryptopp_HEADERS "${CMAKE_CURRENT_SOURCE_DIR}/*.h")

IF (MSVC)
#	ADD_DEFINITIONS (-DCRYPTOPP_GENERATE_X64_MASM)
#	ADD_DEFINITIONS (-DCRYPTOPP_DISABLE_ASM)
#	ADD_DEFINITIONS (-DNDEBUG)
	CMAKE_POLICY(SET CMP0008 NEW)
	SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} /Oi")
ENDIF (MSVC)

# TODO add asm 		echo $(.source)/x64masm.asm ;
#		obj x64masm.obj : $(.source)/x64masm.asm ;

ADD_LIBRARY (cryptopp SHARED ${cryptopp_SOURCES})
#IF(NOT WIN32)
	ADD_LIBRARY (cryptopp_static STATIC  ${cryptopp_SOURCES})
#	SET_TARGET_PROPERTIES(cryptopp_static PROPERTIES OUTPUT_NAME cryptopp)
#ENDIF(NOT WIN32)

IF (WIN32)
	TARGET_LINK_LIBRARIES (cryptopp Ws2_32.lib)
	TARGET_LINK_LIBRARIES (cryptopp_static Ws2_32.lib)
	# We cannot build static versions of this in windows for some reason
ENDIF (WIN32)

IF (WIN32)
	INSTALL (TARGETS cryptopp 
		RUNTIME DESTINATION bin
		LIBRARY DESTINATION bin
		ARCHIVE DESTINATION bin
		)
ELSE (WIN32)
	INSTALL	(TARGETS cryptopp cryptopp_static
		RUNTIME DESTINATION bin
		LIBRARY DESTINATION bin
		ARCHIVE DESTINATION bin
	)
ENDIF (WIN32)

IF(APPLE)
   SET_TARGET_PROPERTIES(cryptopp PROPERTIES COMPILE_FLAGS "-fPIC -w -DOSX  -DNDEBUG -finline-functions -O3 -DCRYPTOPP_DISABLE_ASM")
   SET_TARGET_PROPERTIES(cryptopp_static PROPERTIES COMPILE_FLAGS "-w -DOSX  -DNDEBUG -finline-functions -O3 -DCRYPTOPP_DISABLE_ASM")
ELSEIF(UNIX AND NOT APPLE)
  SET_TARGET_PROPERTIES(cryptopp PROPERTIES COMPILE_FLAGS "-fPIC -w -pipe -DNDEBUG -DLINUX -finline-functions -O3")
  SET_TARGET_PROPERTIES(cryptopp_static PROPERTIES COMPILE_FLAGS " -w -pipe -DNDEBUG -DLINUX -finline-functions -O3")
ELSEIF(WIN32)
  IF(NOT MSVC)
    SET_TARGET_PROPERTIES(cryptopp PROPERTIES COMPILE_FLAGS "-mthreads -w -finline-functions -O3 -DNDEBUG -D__MINGW__ -DWIN32 -D_WIN32_WINNT=0x0501 -D_WIN32")
        SET_TARGET_PROPERTIES(cryptopp_static PROPERTIES COMPILE_FLAGS "-mthreads -w -finline-functions -O3 -DNDEBUG -D__MINGW__ -DWIN32 -D_WIN32_WINNT=0x0501 -D_WIN32")
  ENDIF(NOT MSVC)
ENDIF(APPLE)